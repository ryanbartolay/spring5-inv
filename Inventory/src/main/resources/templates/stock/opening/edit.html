<div class="row">
	<div class="col-lg-12">
	
		<form th:object="${stockOpeningForm}" id="stockOpeningForm" th:action="@{/api/stock/opening}" method="POST">

		<div class="panel panel-default">
			<div class="panel-heading">
				<div class="row ">
					<div class="col-md-4 col-md-offset-8 btn-group"  role="group">
						<button type="submit" id="submitStockOpeningBtn" class="btn btn-success">Save Opening Stock</button>
						<a th:href="@{/stock/opening}" class="btn btn-default">Cancel</a>
					</div>
				</div>
			</div>
			<div class="panel-body">
				
				<div class="form-group" id="errors"></div>
				
				<div class="table-responsive">
				
					<table class="table table-bordered table-striped">
						<tbody>
							<tr>
								<td class="col-md-3">
								
									<div class="input-group">
										<span class="input-group-addon">Date</span>
										<input type="text" th:field="*{transaction_date}" class="form-control">
									</div>
								
								</td>
								<td class="col-md-2">
									<div class="input-group">
										<span class="input-group-addon">Year</span>
										<input type="text" class="form-control yearselect" th:field="*{year}">
									</div>
								</td>
								<td class="col-md-7">
									<div class="input-group">
										<span class="input-group-addon">Location</span>
										<select	class="form-control" th:field="*{location}">
											<option th:each="location : ${locations}" th:value="${location.id}"
												th:text="${location.name}"></option>
										</select>
									</div>
								</td>
							</tr>
							
							<tr>
								<td>
									<div class="input-group">									
										<span class="input-group-addon">Document #</span>
										<input type="text" th:field="*{document_number}" class="form-control">
									</div>
								</td>
								<td colspan="2">
								
								
									<div class="input-group col-md-12">
										<span class="input-group-addon">Description</span>
										<input type="text" id="datepicker" class="form-control">
									</div>
								</td>
							</tr>
						</tbody>
					</table>
						
					<table class="table table-bordered table-striped" id="itemsTable">
						<thead>
							<tr>
								<th>SN</th>
								<th>Code</th>
								<th class="col-md-3">Description</th>
								<th>Unit</th>
								<th>U.Desc</th>
								<th>Quantity</th>
								<th>Unit Cost</th>
								<th class="col-md-2">Total</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							
						</tbody>
						<tfoot>
							<tr>
								<th colspan="6"></th>
								<th><h3>Total</h3></th>
								<th><h3 class="text-right" id="grandTotal"></h3></th>
								<th></th>
							</tr>
						</tfoot>
					</table>
					
					<div class="row">
						<div class="col-md-4">
							<button class="btn btn-success" id="btnAddItem">Add Item</button>
						</div>
					</div>
				
				</div>

			</div>
		</div>
		
		</form>
	</div>
	<!-- /.col-lg-12 -->
</div>

<!-- Item Modal -->
<div th:include="includes/modals/itemModal"></div>

<script>
  $( function() {
	  var current_year = (new Date()).getFullYear();
    $( "#transaction_date" ).datepicker();
    
    $('.yearselect').yearselect({
    	order: 'desc',	
 		start: current_year - 5,
 		end: current_year + 5
    });
    
    $('[name=year]').val( current_year );

    var form = $("#stockOpeningForm");
    var grand_total = 0;
    $("#grandTotal").html(grand_total);
    
    var item_count = 0;
    
    $("#btnAddItem").on("click", function() {
    	addItem({type: "stock_opening", label:"Add Stock Opening Item"}, function(data) {
    		
    		console.log(data);
    		
    		var item = data['item'];
    		var unit = data['unit'];
    		
    		var total = unit.rate * data.unit_cost;
    		grand_total = grand_total + total;
    		
    		var html = `
    		<tr>
				<th>`+ item.id +`</th>
				<td>`+ item.code +`</td>
				<td>`+ item.name +`
					<input type="text" name="stockOpeningItems[`+ item_count +`].item" value="` + item.id + `" />
					<input type="text" name="stockOpeningItems[`+ item_count +`].unit" value="` + unit.id + `" />
					<input type="text" name="stockOpeningItems[`+ item_count +`].quantity" value="` + data.quantity + `" />
						<input type="text" name="stockOpeningItems[`+ item_count +`].unitCost" value="` + data.unit_cost + `" />
				</td>
				<td>`+ unit.abbreviation +`</td>
				<td>`+ unit.name +`</td>
				<td>`+ data.unit_cost +`</td>
				<td>`+ unit.rate +`</td>
				<td class="text-right">`+ total +`</td>
				<td class="text-right">
					<div class="btn-group" role="group">
		        		<button class="btn btn-info fa fa-edit" id="btnView"/>
		        		<button class="btn btn-danger fa fa-times" />
		    		</div>
				</td>
			</tr>`;
			item_count++;
    		
    		$('#itemsTable tbody').append(html);
    		$("#grandTotal").html(grand_total);
    	});
    });
    
   $("#submitStockOpeningBtn").click(function() {
    	console.log(form.serialize());
    	POST("/api/stock/opening", form.serialize(), function(data) {
    		console.log(data);
    		
    		if(data.status != "OK") {
    			displayErrors(data, $("#errors"));	
    		}
    	});
    });
  });
  </script>
</head>
<body>
 
