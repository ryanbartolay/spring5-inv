<div class="col-lg-12">

<!-- Create Button -->
	<button type="button" class="btn btn-success pull-right"
	data-toggle="modal" data-target="#formModal" id="createButton" data-backdrop="static"
	data-keyboard="false">Add Brand</button>	
<!-- /Create Button -->

<!-- Modal Edit Brand -->
<div class="modal fade" id="formModal" tabindex="-1" role="dialog"
	aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form data-async data-target="#rating-modal" id="createBrandForm" th:object="${brandForm}"
				th:action="@{/api/brands}" method="POST">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="modalLabel">Brand Create</h4>
				</div>

				<div class="panel-body">
				
					<div class="form-group" id="errors"></div>
					
					<div class="form-group">
						<label>Company</label> <select
							class="form-control" th:field="*{company_id}" id="ddCompany">
							<option th:each="company : ${companies}" th:value="${company.id}"
								th:text="${company.name}"></option>
						</select>
					</div>
				
					<div class="form-group">
						<label>Name</label> <input class="form-control" id="txtName" th:field="*{name}" maxlength="30">
						<p class="help-block">This is the brand name.</p>
					</div>
					
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
					<button type="submit" id="submit" class="btn btn-success btn-primary">Create</button>
				</div>
			</form>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->


	</div>

	
	<div class="panel panel-default">
		<!-- /.panel-heading -->
		<div class="panel-body">
			<table width="100%"
				class="table table-striped table-bordered table-hover"
				id="brand-datatable">
				<thead>
					<tr>
						<th>Name</th>
						<th>Company</th>
						<th>Actions</th>
					</tr>
				</thead>
				
			</table>
			<!-- /.table-responsive -->
		</div>
		<!-- /.panel-body -->
	</div>
	<!-- /.panel -->
</div>

<!-- DataTables JavaScript -->
<script
	th:src="@{/static/vendor/datatables/js/jquery.dataTables.min.js}"></script>
<script
	th:src="@{/static/vendor/datatables-plugins/dataTables.bootstrap.min.js}"></script>
<script
	th:src="@{/static/vendor/datatables-responsive/dataTables.responsive.js}"></script>
<!-- Page-Level Demo Scripts - Tables - Use for reference -->
<script th:src="@{/static/js/ajax-form.js}"></script>
<script>
/*<![CDATA[*/
	
	$(document).ready(function() {
		var formModal = $("#formModal");
		var modalLabel = formModal.find("#modalLabel");
		var submitButtonLabel = $("#formModal #submit");
		var form = $("#createBrandForm");
		
		var brand_table = $('#brand-datatable').DataTable({
			responsive : true,
			ajax: {
				url: '/api/datatable/brands'
			},
			processing: true,
	        serverSide: true,
			length: 5,
			start: 0,
	        columns: [
                { "data": "name", "name" : "Name", "title" : "Namezzzz"  },
                { "data": "company_name", "name" : "Company" , "title" : "Company Inc."},
            ],
            "columnDefs": [ {
                "targets": 2,
                "data": null,
                "defaultContent": '<button type="button" class="btn btn-success pull-right" data-toggle="modal" data-target="#formModal" data-backdrop="static" data-keyboard="false" id="edit_record">Edit</button> / <a href="" class="editor_remove">Delete</a>'
            } ]
		});
		
		$("#createButton").on('click', function (e) {
			form.attr("method", "POST"); // change to POST when editing
			modalLabel.text("Create new Brand");
			submitButtonLabel.text("Create");
		});
		
		// Edit button
	    $("#brand-datatable tbody").on('click', 'button', function (e) {
	        e.preventDefault();
	 		
	        var data = brand_table.row( $(this).parent('td') ).data();
	        
	        modalLabel.text("Update " + data['name']);
	        submitButtonLabel.text("Update");
	        form.attr("method", "PUT"); // change to put when editing

	        GETJSON("/api/brands/" + data['id'], function(data) {
	        	console.log(data);
	        	form.find('#txtName').val(data.name);
	        	form.find('#ddCompany').val(data.company.id);
	        });
	    } );

		
		formModal($("#createBrandForm"), function() {
			brand_table.ajax.reload( null, false ); // user paging is not reset on reload
		});
	});
/*]]>*/
</script>