<div class="row">
	<div class="col-lg-12">
		<form th:object="${salesInvoiceForm}" id="salesInvoiceForm"
			th:action="@{/api/sales/invoice}" method="POST">

			<div class="panel panel-default">
				<div class="panel-heading">
					<div class="row ">
						<div class="col-md-12">
							<div class="btn-group pull-right" role="group">
								<button type="submit" id="submitSalesInvoiceBtn"
									class="btn btn-success btn-sm">Save Sales Invoice</button>
								<a th:href="@{/sales/invoice}" class="btn btn-default btn-sm">Cancel</a>
							</div>
						</div>
					</div>
				</div>
				<div class="panel-body">

					<div class="form-group" id="errors"></div>

					<div class="col-md-3">
						<label>System Number :</label> <input type="text"
							class="form-control" disabled="disabled"
							th:field="${salesInvoice.systemNumber}"> <label>Document
							Number :</label> <input type="text" class="form-control"
							disabled="disabled" th:field="${salesInvoice.documentNumber}">
					</div>

					<div class="col-md-3">
						<label>Customer:</label> <input type="text" class="form-control"
							disabled="disabled" th:field="${salesInvoice.customer}"> <label>Payment
							Method :</label> <input type="text" class="form-control"
							disabled="disabled" th:field="${salesInvoice.paymentMethod}">
					</div>

					<div class="col-md-3">
						<label>Transaction Date:</label>
						
						<input
								type="text" class="form-control" disabled="disabled"
								th:field="${salesInvoice.transactionDate}">
						<label>Year :</label> <input type="text" class="form-control"
							disabled="disabled" th:field="${salesInvoice.year}">

					</div>

					<div class="col-md-3">
						<label>Location:</label> <input type="text" class="form-control"
							disabled="disabled" th:field="${salesInvoice.location}">
					</div>

					<div class="col-md-12 clearfix">
						<label>Description :</label> <input type="text"
							class="form-control" disabled="disabled"
							th:field="${salesInvoice.description}">
					</div>
					
					<div class="col-md-12">
						<br>
						<button class="btn btn-success btn-sm" id="btnAddItem">Add
							Item</button>
					</div>

					<div class="table-responsive col-md-12">
						
						<table class="table table-bordered table-striped" id="itemsTable">
							<thead>
								<tr>
									<th>SN</th>
									<th>Code</th>
									<th class="col-md-3">Description</th>
									<th>Unit</th>
									<th>U.Desc</th>
									<th>Quantity</th>
									<th class="text-right">Unit Price</th>
									<th class="col-md-2 text-right">Subtotal</th>
									<th></th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</form>
	</div>
	<!-- /.col-lg-12 -->
</div>

<!-- Item Modal -->
<div th:include="includes/modals/itemModal_salesReturnItems"></div>

<!-- DataTables JavaScript -->
<script
	th:src="@{/static/vendor/datatables/js/jquery.dataTables.min.js}"></script>
<script
	th:src="@{/static/vendor/datatables-plugins/dataTables.bootstrap.min.js}"></script>
<script
	th:src="@{/static/vendor/datatables-responsive/dataTables.responsive.js}"></script>

<script type="text/javascript" th:inline="javascript">
/*<![CDATA[*/

var systemNumber = /*[[${salesInvoice.systemNumber}]]*/ '0';

var form_items = [];

$( function() {
	var current_year = (new Date()).getFullYear();
	
	$( "#transactionDate" ).datepicker();
	
    $('.yearselect').yearselect({
    	order: 'desc',	
 		start: current_year - 5,
 		end: current_year + 5
    });
    
    $('[name=year]').val( current_year );
});

$("#btnAddItem").on("click", function() {
	addItem({type: "sales_return", systemNumber: systemNumber, label:"Invoice # : " + systemNumber }, function(data) {
		
  		for(var i = 0; i < data.length; i++) {
  			form_items.push(data[i]);
  		}
				
		var html = ``;
  		for(var i = 0; i < form_items.length; i++) {
  		
  			var item = form_items[i];
  			
  			html += `<tr>
				<th id="lblItemId">`+ item.id +`<input type="hidden" name="stockOpeningItems[`+i+`].item" value="`+item["id"]+`" /></th>
				<td id="lblItemName">`+ item["itemCode"] +`</td>
				<td id="lblItemName">`+ item["itemName"] +`</td>
				<td id="lblItemName">`+ item["unitAbbreviation"] +`</td>
				<td id="lblItemName">`+ item["unitDescription"] +`</td>
				<td id="lblItemName" class="text-right">`+ item["quantity"] +`</td>
				<td id="lblItemName" class="text-right">`+ item["unitPrice"] +`</td>
				<td id="lblItemName" class="text-right">`+ item["unitPriceTotal"] +`</td>
				<td id="lblItemName"><button class="btn btn-danger fa fa-times" onClick="remove(this, `+i+`)" /></td>`;
  			
  		}
  		
  		$('#itemsTable tbody').html(html);
	});
});

function remove(e, item_index) {
	form_items.splice(item_index, 1); // remove this element from the item array
	$(e).parentsUntil("tbody").remove();
}

/*]]>*/
</script>
